{{- if .Values.bootstrap.enabled }}
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: {{ include "lldap.fullname" . }}-users
stringData:
  {{ .Values.lldap.ldapUserDN }}.json: |-
    {
      "id": {{ .Values.lldap.ldapUserDN | quote }},
      "password_file": "/credentials/{{ .Values.lldap.ldapUserPassKey }}",
      "displayName": "Administrator",
      "groups": ["lldap_admin"]
    }
  {{- range .Values.bootstrap.users }}
  {{ .id }}.json: |-
    {
      "id": "{{ .id }}",
      "email": "{{ .email }}",
      {{- if (hasKey . "passwordSecret") }}
      "password_file": "/user-secrets/{{ .passwordSecret.name }}/{{ .passwordSecret.key }}",
      {{- else }}
      "password": "{{ .password }}",
      {{- end }}
      "displayName": "{{ .displayName }}",
      "firstName": "{{ .firstName }}",
      "lastName": "{{ .lastName }}",
      "avatar_file": "{{ .avatar_file }}",
      "avatar_url": "{{ .avatar_url }}",
      "gravatar_avatar": "{{ .gravatar_avatar }}",
      "weserv_avatar": "{{ .weserv_avatar }}",
      "groups": {{ .groups | toJson }}
    }
  {{- end }}
{{- end }}
